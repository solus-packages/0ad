name       : 0ad
version    : 0.0.22a
release    : 4
source     :
    - http://releases.wildfiregames.com/0ad-0.0.22-alpha-unix-build.tar.xz : fddd36df4fd32b5b31fd8871bc5ed3ec71a921de79517fb6199ba7571ec9f5b1
license    :
    - BSD-2-Clause
    - CC-BY-SA-3.0 # Mods
    - GPL-2.0
    - ISC # Encryption
    - MIT
    - Zlib # tinygettext third party 
component  : games.strategy
summary    : 0 A.D. is a free, open-source, cross-platform real-time strategy game
    of ancient warfare.
description: |
    0 A.D. is a free, open-source, cross-platform real-time strategy game of ancient warfare.
builddeps  :
    - pkgconfig(gl)
    - pkgconfig(gloox)
    - pkgconfig(icu-io)
    - pkgconfig(libcurl)
    - pkgconfig(libenet)
    - pkgconfig(libjpeg)
    - pkgconfig(libpng15)
    - pkgconfig(libtiff-4)
    - pkgconfig(mozjs-38)
    - pkgconfig(openal)
    - pkgconfig(sdl2)
    - pkgconfig(vorbis)
    - pkgconfig(xcursor)
    - libboost-devel
    - miniupnpc-devel
    - wxwidgets-devel
rundeps    :
    - 0ad-data
setup      : |
    %patch -p1 < $pkgfiles/0001-Add-startup-class-to-desktop-file-so-we-can-provide-.patch
    %patch -p1 < $pkgfiles/0ad-rpath.patch
    %patch -p1 < $pkgfiles/0ad-mozjs-incompatible.patch
    cd build/workspaces
    sed -i '3,6d' update-workspaces.sh
    ./update-workspaces.sh \
        --bindir=/usr/bin \
        --datadir=/usr/share/0ad/data \
        --disable-atlas \
        --libdir=%libdir%/0ad \
        --with-system-mozjs38 \
        --without-nvtt
build      : |
    cd build/workspaces/gcc
    %make
install    : |
    install -dm00644 $installdir/%libdir%/0ad/
    install -dm00644 $installdir/usr/share/0ad/data/
    install -Dm00755 binaries/system/pyrogenesis $installdir/usr/bin/pyrogenesis
    install -Dm00755 binaries/system/*.so $installdir/%libdir%/0ad/
    cp -R binaries/data/l10n/ $installdir/usr/share/0ad/data/
    chmod 00644 $installdir/usr/share/0ad/data/*
    install -Dm00755 build/resources/0ad.sh $installdir/usr/bin/0ad
    install -Dm00644 build/resources/0ad.desktop $installdir/usr/share/applications/0ad.desktop
    install -Dm00644 build/resources/0ad.png $installdir/usr/share/pixmaps/0ad.png
